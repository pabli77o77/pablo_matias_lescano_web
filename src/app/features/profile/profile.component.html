@if (store.isLoading()) {
  <div class="loading container">
    <div class="skeleton-header"></div>
    <div class="skeleton-lines"></div>
  </div>
}

@if (store.error()) {
  <div class="error container">{{ store.error() }}</div>
}

@if (store.data(); as user) {
  <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">

    @if (store.viewMode() === 'frontend') {
      <!-- MODO FRONTEND (Premium UI) -->
      <div class="frontend-view relative">
        
        <!-- STICKY JUMP MENU (Desktop Only) -->
        <nav class="hidden xl:flex flex-col gap-6 fixed right-8 top-1/2 -translate-y-1/2 z-50">
          <a href="#about" class="group relative flex items-center justify-center w-4 h-4" aria-label="Go to About">
            <span class="absolute right-[100%] mr-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs font-bold whitespace-nowrap bg-slate-800 text-slate-200 px-2 py-1 rounded border border-slate-700 pointer-events-none shadow-xl">
              Inicio
            </span>
            <div class="w-3 h-3 rounded-full bg-slate-600 group-hover:bg-sky-400 group-hover:scale-125 transition-all duration-300 shadow-lg"></div>
          </a>
          
          <a href="#skills" class="group relative flex items-center justify-center w-4 h-4" aria-label="Go to Skills">
            <span class="absolute right-[100%] mr-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs font-bold whitespace-nowrap bg-slate-800 text-slate-200 px-2 py-1 rounded border border-slate-700 pointer-events-none shadow-xl">
              Stack
            </span>
            <div class="w-3 h-3 rounded-full bg-slate-600 group-hover:bg-sky-400 group-hover:scale-125 transition-all duration-300 shadow-lg"></div>
          </a>
          
          <a href="#labs" class="group relative flex items-center justify-center w-4 h-4" aria-label="Go to Labs">
            <span class="absolute right-[100%] mr-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs font-bold whitespace-nowrap bg-slate-800 text-slate-200 px-2 py-1 rounded border border-slate-700 pointer-events-none shadow-xl">
              Labs
            </span>
            <div class="w-3 h-3 rounded-full bg-slate-600 group-hover:bg-sky-400 group-hover:scale-125 transition-all duration-300 shadow-lg"></div>
          </a>
          
          <a href="#experience" class="group relative flex items-center justify-center w-4 h-4" aria-label="Go to Experience">
            <span class="absolute right-[100%] mr-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300 text-xs font-bold whitespace-nowrap bg-slate-800 text-slate-200 px-2 py-1 rounded border border-slate-700 pointer-events-none shadow-xl">
              Experiencia
            </span>
            <div class="w-3 h-3 rounded-full bg-slate-600 group-hover:bg-sky-400 group-hover:scale-125 transition-all duration-300 shadow-lg"></div>
          </a>
        </nav>

        <header id="about" class="profile-header scroll-mt-24">
          <span class="hero-name animate-in fade-in slide-in-from-bottom-3 duration-700 fill-mode-both">{{ user.personal_info.name }}</span>

          <h1 class="text-white font-extrabold text-4xl md:text-5xl lg:text-6xl tracking-tight mb-6 animate-in fade-in slide-in-from-bottom-4 duration-700 delay-150 fill-mode-both">
            Software Architect & <span class="text-sky-400">Tech Lead</span>
          </h1>

          <p class="text-slate-400 text-lg md:text-xl leading-relaxed max-w-[700px] mb-8 animate-in fade-in slide-in-from-bottom-5 duration-700 delay-300 fill-mode-both">
            +{{ user.totalExperienceYears }} aÃ±os transformando arquitecturas empresariales en soluciones
            <span class="text-sky-400 font-medium">AWS Cloud & Data</span> de alto rendimiento.
            Experto en <span class="text-sky-400 font-medium">TDD</span>, <span class="text-sky-400 font-medium">DDD</span>,
            <span class="text-sky-400 font-medium">CQRS</span> y
            <span class="text-sky-400 font-medium">Angular (Signals)</span>.
          </p>

          <!-- KPI Row -->
          <div class="kpi-container">
            <div class="kpi-card">
              <span class="kpi-value">+{{ user.totalExperienceYears }}</span>
              <span class="kpi-label">{{ store.ui().kpiExp }}</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-value">95%</span>
              <span class="kpi-label">{{ store.ui().kpiOptimization }}</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-value">+95</span>
              <span class="kpi-label">{{ store.ui().kpiSources }}</span>
            </div>
          </div>

          <div class="actions-row">
            <button class="btn-primary shimmer-btn" (click)="store.toggleViewMode()">
              <span class="icon">âš¡</span> {{ store.ui().switchToData }}
            </button>
            
            <a class="btn-secondary" 
               [href]="cvUrl()" 
               [download]="cvFileName()"
               (click)="onDownloadClick()">
              <span class="icon">ðŸ“„</span> {{ store.ui().downloadCV }}
            </a>
          </div>
        </header>

        <section id="skills" class="skills-section animate-enter delay-1 scroll-mt-24">
          <h3>{{ store.ui().techStack }}</h3>
          <app-tech-stack [skills]="user.skills"></app-tech-stack>
        </section>

        <!-- R&D Innovation Section -->
        <div id="labs" class="scroll-mt-24">
          <app-research-labs></app-research-labs>
        </div>

        <section id="experience" class="experience-section animate-enter delay-2 scroll-mt-24">
          <h3>{{ store.ui().experienceHighlights }}</h3>
          <app-experience-timeline [experiences]="user.experience"></app-experience-timeline>
        </section>
      </div>
    } @else {
      <!-- MODO DATA (Architecture View) -->
      <div class="data-view-container animate-enter">
        <header class="data-header">
          <h2 class="text-accent">{{ store.ui().architectureView }}</h2>
          <p>{{ store.ui().jsonDesc }}</p>
        </header>

        <app-data-view [data]="user"></app-data-view>
      </div>
    }

  </div>
}